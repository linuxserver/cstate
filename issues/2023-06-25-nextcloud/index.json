{"is":"issue","title":"Notification: Changes to our Nextcloud image","body":"\u003cp\u003eWe are releasing a new version of our \u003ca href=\"https://github.com/linuxserver/docker-nextcloud/\"\u003eNextcloud image\u003c/a\u003e that is built with the Nextcloud application inside the image, rather than in the user \u003ccode\u003e/config\u003c/code\u003e volume. This means manually updating Nextcloud via command line will no longer be necessary or supported. The \u003ccode\u003eupdater.phar\u003c/code\u003e command is completely removed. Installations for existing users will be migrated automatically when updating the container image. All future updates to your Nextcloud instance will happen via container image updates.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eUpdating via the admin web UI is no longer supported.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eDowngrading is not supported.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eAn important thing to keep in mind is that systems that automatically update your container will result in irreversible changes to your Nextcloud instance. We recommend pinning a specific tagged version like \u003ccode\u003elscr.io/linuxserver/nextcloud:version-27.0.0\u003c/code\u003e and manually changing your image version when you are ready to upgrade.\u003c/p\u003e\n\u003cp\u003eExcerpts from the updated README:\u003c/p\u003e\n\u003ch3 id=\"updating-nextcloud\"\u003eUpdating Nextcloud\u003c/h3\u003e\n\u003cp\u003eUpdating Nextcloud is done by pulling the new image, and recreating the container with it.\u003c/p\u003e\n\u003cp\u003eIt is only possible to upgrade one major version at a time. For example, if you want to upgrade from version 14 to 16, you will have to upgrade from version 14 to 15, then from 15 to 16.\u003c/p\u003e\n\u003cp\u003eSince all data is stored in the \u003ccode\u003e/config\u003c/code\u003e and \u003ccode\u003e/data\u003c/code\u003e volumes, nothing gets lost. The startup script will check for the version in your volume and the installed docker version. If it finds a mismatch, it automatically starts the upgrade process.\u003c/p\u003e\n\u003ch3 id=\"cant-start-nextcloud\"\u003eCan\u0026rsquo;t start Nextcloud\u003c/h3\u003e\n\u003cp\u003eIf after updating your container image you receive a message along these lines:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCan\u0026rsquo;t start Nextcloud because the version of the data (\u003ccode\u003e#.#.#.#\u003c/code\u003e) is more than one major version behind the docker image version (\u003ccode\u003e#.#.#.#\u003c/code\u003e) and upgrading more than one major version is not supported. Please run an image tagged for the major version \u003ccode\u003e##\u003c/code\u003e first.\u0026quot;\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThe version of Nextcloud that you have installed in your persistent \u003ccode\u003e/config\u003c/code\u003e volume will need to be updated using an older image before you can use the new image.\u003c/p\u003e\n\u003cp\u003eMajor version images, to be used for upgrading:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eImage/Tag\u003c/th\u003e\n\u003cth\u003ePHP\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elscr.io/linuxserver/nextcloud:version-26.0.2\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e8.2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elscr.io/linuxserver/nextcloud:version-25.0.4\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e8.1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elscr.io/linuxserver/nextcloud:version-24.0.12\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e8.1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elscr.io/linuxserver/nextcloud:version-23.0.4\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e7.4\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elscr.io/linuxserver/nextcloud:version-22.2.3\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e7.4\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elscr.io/linuxserver/nextcloud:version-21.0.3\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e7.4\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elscr.io/linuxserver/nextcloud:version-20.0.7\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e7.4\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003ePackage locked tags, listed for LSIO team reference:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eImage/Tag\u003c/th\u003e\n\u003cth\u003ePHP\u003c/th\u003e\n\u003cth\u003eNotes\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elscr.io/linuxserver/nextcloud:26.0.2-ls245\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e8.1\u003c/td\u003e\n\u003ctd\u003eLast tag with PHP 8.1\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003elscr.io/linuxserver/nextcloud:24.0.6-ls204\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e7.4\u003c/td\u003e\n\u003ctd\u003eLast tag with PHP 7.4\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cul\u003e\n\u003cli\u003eCheck your \u003ccode\u003e/config/www/nextcloud/config/config.php\u003c/code\u003e file or \u003ccode\u003e/config/www/nextcloud/version.php\u003c/code\u003e file to determine the version you have installed\u003c/li\u003e\n\u003cli\u003eSwitch your image to the corresponding major version from the table above (ex: your files indicate \u003ccode\u003e24.x.x\u003c/code\u003e, use \u003ccode\u003elscr.io/linuxserver/nextcloud:version-24.0.12\u003c/code\u003e) and start the container\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003edocker exec -it nextcloud updater.phar\u003c/code\u003e \u003cstrong\u003e\u003cem\u003erepeatedly\u003c/em\u003e\u003c/strong\u003e until you have updated to Nextcloud \u003ccode\u003e27.x.x\u003c/code\u003e, or the updater says \u003ccode\u003eThis version of Nextcloud is not compatible with \u0026gt; PHP x.x\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eCheck your files again to determine the version you have installed\n\u003cul\u003e\n\u003cli\u003eIf your installed version is below 26, repeat the steps above until you get to version 26\u003c/li\u003e\n\u003cli\u003eIf your installed version is 26 or 27, continue with the instructions below\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSwitch your image to \u003ccode\u003elscr.io/linuxserver/nextcloud:version-27.0.0\u003c/code\u003e and start the container. Note the \u003ccode\u003eupdater.phar\u003c/code\u003e is no longer available, or needed\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003edocker logs nextcloud\u003c/code\u003e and check for any issues (report \u003ca href=\"https://github.com/linuxserver/docker-nextcloud/issues\"\u003eissues on GitHub\u003c/a\u003e)\u003c/li\u003e\n\u003cli\u003eAs of posting this information, Nextclouod 27 is the latest current version. If you are reading this after a new major version of Nextcloud beyond 27 is released, check \u003ca href=\"https://github.com/linuxserver/docker-nextcloud/releases\"\u003ereleases on GitHub\u003c/a\u003e and proceed to switch to the next major version tag one by one until you are current. Updating more than one major version at a time is not supported\u003c/li\u003e\n\u003cli\u003eYou should now be able to switch your image to \u003ccode\u003elscr.io/linuxserver/nextcloud\u003c/code\u003e (no tag) if you prefer to run the latest image (although we do recommend pinning a specific version)\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003edocker exec -it nextcloud mv /config/nginx/site-confs/default.conf /config/nginx/site-confs/default.conf.bak\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003edocker exec -it nextcloud mv /config/nginx/nginx.conf /config/nginx/nginx.conf.bak\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eRun \u003ccode\u003edocker restart nextcloud\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eNextcloud should now be in a working state\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOptional:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIf you had customized any of the nginx configs that were renamed above, compare the \u003ccode\u003e.bak\u003c/code\u003e file to the new live file and apply any customizations you require. Note the \u003ccode\u003eroot\u003c/code\u003e line in \u003ccode\u003esite-confs/default.conf\u003c/code\u003e should be changed from \u003ccode\u003e/config/www/nextcloud/\u003c/code\u003e to \u003ccode\u003e/app/www/public\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eRemove the \u003ccode\u003e.bak\u003c/code\u003e files\u003c/li\u003e\n\u003c/ul\u003e\n","createdAt":"2023-06-25 22:00:00 +0000 UTC","lastMod":"2023-08-03 13:29:04 +0000 UTC","permalink":"https://info.linuxserver.io/issues/2023-06-25-nextcloud/","severity":"<no value>","resolved":false,"informational":true,"resolvedAt":"<no value>","affected":["Notifications","nextcloud"],"filename":"2023-06-25-nextcloud.md"}