{"is":"issue","title":"Notification: Significant changes to nginx based images","body":"\u003cp\u003eMost images using our alpine-nginx base image are being updated to alpine 3.15 with php8 and some significant changes to the nginx configs.\u003c/p\u003e\n\u003cp\u003eChanges you will likely notice:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBring our default shipped configs as close as possible to alpine upstream defaults\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://git.alpinelinux.org/aports/tree/main/nginx/nginx.conf?h=3.15-stable\"\u003ehttps://git.alpinelinux.org/aports/tree/main/nginx/nginx.conf?h=3.15-stable\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eInclude \u003ccode\u003eworker_processes.conf\u003c/code\u003e and init script to generate it in the base\u003c/li\u003e\n\u003cli\u003eInclude \u003ccode\u003eresolver.conf\u003c/code\u003e and init script to generate it in the base\u003c/li\u003e\n\u003cli\u003eInclude \u003ccode\u003essl.conf\u003c/code\u003e in the base (the same as what is currently shipped in SWAG, but adjusted to use the self-signed certs generated by the base)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003einclude /config/nginx/site-confs/*.conf;\u003c/code\u003e with \u003ccode\u003e*.conf\u003c/code\u003e extension (rename existing user files automatically)\u003c/li\u003e\n\u003cli\u003eRework \u003ccode\u003edefault.conf\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eExpect applications inside containers to exist at \u003ccode\u003e/app/www/public/\u003c/code\u003e, and if that does not exist, use \u003ccode\u003e/config/www\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eInclude ipv6 support\u003c/li\u003e\n\u003cli\u003edeny access to \u003ccode\u003e.htaccess\u003c/code\u003e/\u003ccode\u003e.htpasswd\u003c/code\u003e files\u003c/li\u003e\n\u003cli\u003eadjust php location and \u003ccode\u003efastcgi_params\u003c/code\u003e to use \u003ccode\u003ePATH_INFO\u003c/code\u003e and mitigate \u003ccode\u003eHTTP_PROXY\u003c/code\u003e vulnerability\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eRestructure nginx configs\n\u003cul\u003e\n\u003cli\u003eConfigs in \u003ccode\u003e/defaults/nginx/\u003c/code\u003e are recursively copied to the user\u0026rsquo;s \u003ccode\u003e/config/nginx/\u003c/code\u003e (maintaining the structure)\u003c/li\u003e\n\u003cli\u003eAll configs are now named \u003ccode\u003e*.sample\u003c/code\u003e and all include \u003ccode\u003e## Version YYYY/MM/DD - Changelog: \u0026lt;url to repo history\u0026gt;\u003c/code\u003e used by \u003ccode\u003e/etc/cont-init.d/85-version-checks\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eRequired configs (\u003ccode\u003e/config/nginx/nginx.conf\u003c/code\u003e, \u003ccode\u003e/config/nginx/server-confs/ssl.conf\u003c/code\u003e and \u003ccode\u003e/config/nginx/site-confs/default.conf\u003c/code\u003e) are enabled by default. Downstream images can include and/or enable others as needed (ex: SWAG will enable \u003ccode\u003e/config/nginx/location-confs/proxy.conf\u003c/code\u003e and \u003ccode\u003e/config/nginx/server-confs/502.conf\u003c/code\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eFolder structure is as follows (in the \u003ccode\u003e/config/nginx/\u003c/code\u003e context):\n\u003cul\u003e\n\u003cli\u003eAll nginx based images:\n\u003cul\u003e\n\u003cli\u003eIncludes \u003ccode\u003enginx.conf\u003c/code\u003e (enabled by default)\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003eresolver.conf\u003c/code\u003e (enabled by default)\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003essl.conf\u003c/code\u003e (enabled by default)\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003eworker_processes.conf\u003c/code\u003e (enabled by default)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e/config/nginx/site-confs/*\u003c/code\u003e included inside the \u003ccode\u003ehttp\u003c/code\u003e context in \u003ccode\u003e/config/nginx/nginx.conf\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eIncludes \u003ccode\u003edefault.conf\u003c/code\u003e (enabled by default)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSWAG:\n\u003cul\u003e\n\u003cli\u003eIncludes \u003ccode\u003e502.conf\u003c/code\u003e (enabled by default)\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003eauthelia-location.conf\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003eauthelia-server.conf\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003eldap-location.conf\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003eldap-server.conf\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eIncludes \u003ccode\u003eproxy.conf\u003c/code\u003e (enabled by default)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eUnder the hood:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSplit out init scripts\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eroot/migrations/01-nginx-site-confs-default\u003c/code\u003e migrate existing \u003ccode\u003edefault\u003c/code\u003e to \u003ccode\u003edefault.conf\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot/etc/cont-init.d/11-folders\u003c/code\u003e creates all the folders needed in \u003ccode\u003e/config\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot/etc/cont-init.d/12-samples\u003c/code\u003e removes existing \u003ccode\u003e*.sample\u003c/code\u003e files from \u003ccode\u003e/config/nginx\u003c/code\u003e and copies any included \u003ccode\u003e*.sample\u003c/code\u003e files from the image\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot/etc/cont-init.d/13-nginx\u003c/code\u003e enable required configs (\u003ccode\u003enginx.conf\u003c/code\u003e, \u003ccode\u003essl.conf\u003c/code\u003e and \u003ccode\u003edefault.conf\u003c/code\u003e) if they don\u0026rsquo;t exist, setup \u003ccode\u003edhparams.pem\u003c/code\u003e, setup \u003ccode\u003eresolver.conf\u003c/code\u003e, setup \u003ccode\u003eworker_processes.conf\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot/etc/cont-init.d/14-php\u003c/code\u003e configure php\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot/etc/cont-init.d/15-keygen\u003c/code\u003e create self signed certificates for \u003ccode\u003essl.conf\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot/etc/cont-init.d/20-permissions\u003c/code\u003e set \u003ccode\u003e/config\u003c/code\u003e permissions\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot/etc/cont-init.d/85-version-checks\u003c/code\u003e check all enabled \u003ccode\u003e*.conf\u003c/code\u003e files against all \u003ccode\u003e*.sample\u003c/code\u003e files shipped with the image and alert the user about updates\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eStatus of affected images:\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eImage\u003c/th\u003e\n\u003cth\u003eBranch\u003c/th\u003e\n\u003cth\u003ePR\u003c/th\u003e\n\u003cth\u003eNotes\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003ebaseimage-alpine-nginx\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-baseimage-alpine-nginx/pull/84\"\u003ehttps://github.com/linuxserver/docker-baseimage-alpine-nginx/pull/84\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ebookstack\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-bookstack/pull/113\"\u003ehttps://github.com/linuxserver/docker-bookstack/pull/113\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ecops\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-cops/pull/34\"\u003ehttps://github.com/linuxserver/docker-cops/pull/34\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003ecomposer downgraded to v1 for compatibility\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ediskover\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-diskover/pull/43\"\u003ehttps://github.com/linuxserver/docker-diskover/pull/43\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003edokuwiki\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-dokuwiki/pull/43\"\u003ehttps://github.com/linuxserver/docker-dokuwiki/pull/43\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003efreshrss\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-freshrss/pull/40\"\u003ehttps://github.com/linuxserver/docker-freshrss/pull/40\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003egrav\u003c/td\u003e\n\u003ctd\u003emain\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-grav/pull/9\"\u003ehttps://github.com/linuxserver/docker-grav/pull/9\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003egrocy\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-grocy/pull/52\"\u003ehttps://github.com/linuxserver/docker-grocy/pull/52\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eheimdall\u003c/td\u003e\n\u003ctd\u003emain\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-heimdall/pull/79\"\u003ehttps://github.com/linuxserver/docker-heimdall/pull/79\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elibrespeed\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-librespeed/pull/15\"\u003ehttps://github.com/linuxserver/docker-librespeed/pull/15\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003elychee\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-lychee/pull/51\"\u003ehttps://github.com/linuxserver/docker-lychee/pull/51\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003emuximux\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-muximux/pull/26\"\u003ehttps://github.com/linuxserver/docker-muximux/pull/26\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003enextcloud\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-nextcloud/pull/219\"\u003ehttps://github.com/linuxserver/docker-nextcloud/pull/219\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003enginx\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-nginx/pull/79\"\u003ehttps://github.com/linuxserver/docker-nginx/pull/79\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ephotoshow\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-photoshow/pull/28\"\u003ehttps://github.com/linuxserver/docker-photoshow/pull/28\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://info.linuxserver.io/issues/2022-10-14-photoshow/\"\u003eDeprecated\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003ephpmyadmin\u003c/td\u003e\n\u003ctd\u003emain\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-phpmyadmin/pull/12\"\u003ehttps://github.com/linuxserver/docker-phpmyadmin/pull/12\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003epiwigo\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-piwigo/pull/49\"\u003ehttps://github.com/linuxserver/docker-piwigo/pull/49\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003epixapop\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-pixapop/pull/11\"\u003ehttps://github.com/linuxserver/docker-pixapop/pull/11\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://info.linuxserver.io/issues/2022-10-14-pixapop\"\u003eDeprecated\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eprojectsend\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-projectsend/pull/22\"\u003ehttps://github.com/linuxserver/docker-projectsend/pull/22\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esnapdrop\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-snapdrop/pull/6\"\u003ehttps://github.com/linuxserver/docker-snapdrop/pull/6\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esnipe-it\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-snipe-it/pull/28\"\u003ehttps://github.com/linuxserver/docker-snipe-it/pull/28\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eswag\u003c/td\u003e\n\u003ctd\u003emaster\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-swag/pull/169\"\u003ehttps://github.com/linuxserver/docker-swag/pull/169\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003exbackbone\u003c/td\u003e\n\u003ctd\u003emain\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/linuxserver/docker-xbackbone/pull/5\"\u003ehttps://github.com/linuxserver/docker-xbackbone/pull/5\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eAny images with notes above may not be merged. We will make efforts to update this page if any of the images with notes above are merged at a later date. We may also make individual announcements about status updates regarding these images.\u003c/p\u003e\n","createdAt":"2022-08-20 18:00:00 +0000 UTC","lastMod":"2022-10-14 09:13:45 -0500 -0500","permalink":"https://info.linuxserver.io/issues/2022-08-20-nginx-base/","severity":"<no value>","resolved":false,"informational":true,"resolvedAt":"<no value>","affected":["Notifications","bookstack","cops","diskover","dokuwiki","freshrss","grav","grocy","heimdall","librespeed","lychee","muximux","nextcloud","nginx","photoshow","phpmyadmin","piwigo","pixapop","projectsend","snapdrop","snipe-it","swag","xbackbone"],"filename":"2022-08-20-nginx-base.md"}