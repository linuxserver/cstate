<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="There is a known issue with MariaDB when updating the container image to a new version. If a database upgrade is required and user databases are not in a healthy state, then the MariaDB service may fail to start.
MariaDB version updates (ex: 10.6.x to 10.11.x) can happen when updating the container image. Upgrading user databases is done manually by running a command.
Recovery Procedure If you have recently updated your container image and your container logs show repeating entries of:"><title>Known Issue: MariaDB Check and Repair | Info :: LinuxServer.io</title><link rel=canonical href=https://info.linuxserver.io/issues/2023-05-29-mariadb/><link rel=alternate type=application/json href=https://info.linuxserver.io/issues/2023-05-29-mariadb/index.json title="Info :: LinuxServer.io"><meta name=generator content="cState v5.6.1 - https://github.com/cstate/cstate"><meta name=theme-color content="#0a0c0f"><script>var themeBrandColor='#0a0c0f',themeOkColor='#008000',themeNoticeColor='#24478f',themeDisruptedColor='#cc4400',themeDownColor='#e60000'</script><style>html,body{margin:0;background:#fff;color:#4d4d4d;font:100%/1.5 inter,inter ui,BlinkMacSystemFont,-apple-system,san francisco text,roboto,segoe ui,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,.25)}::selection{background:#b4d5ff}*,*:before,*:after{box-sizing:inherit}a{text-decoration:none;color:#000;border-bottom:1px dotted}a:hover{border-bottom-style:solid}a:active{position:relative;top:2px}hr{border:0;border-bottom:1px solid #ccc;margin:24px 0}h1{font-size:40px;line-height:1}h2{font-size:26px}h3{font-size:20px}h4{font-size:18px}h1,h2,h4{font-weight:400;color:#000;font-family:inter,inter ui,segoe ui,BlinkMacSystemFont,-apple-system,san francisco display,roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol;letter-spacing:-.4px;overflow-wrap:break-word}h3{margin:0;color:#000}img{border:0;width:100%;height:auto}.hidden{display:none}a.no-underline{border-bottom:0}.headline{font-size:20px}.bold{color:#000}.hinted{color:#6d6d6d}.faded{color:#6d6d6d}.clean{margin:0}.ok{color:green}.warning{color:#c40}.error{color:#e60000}.contain{max-width:640px;margin:16px auto;padding:16px}.markdown pre{overflow-x:scroll}.contain--more{max-width:680px}.center{text-align:center}.right{text-align:right}.padding-s{padding:6px}.padding{padding:12px}.clicky{cursor:pointer}.link-style{border:none}.span-icon{float:right;margin-left:16px}.js .category--open .category__closed-marker{display:none}.js .category--closed .components{display:none}.js .category--closed .category__open-marker{display:none}.js .hidden-with-js{display:none}.hide-without-js{display:none}.js span.hide-without-js{display:inline}.js div.hide-without-js{display:block}.date{display:block;margin-top:12px;color:#666;font-variant:small-caps}.tag{display:inline-block;padding:4px 8px;margin-right:4px;margin-bottom:2px;background:#eee}.tag:hover{background:#ddd}.header{padding:8px 0;background:#0a0c0f}.header a{color:#fff;font-size:14px;font-variant:small-caps}.header a h1{color:#fff}.header__logo img{height:auto;width:320px}.header__logo--small img{height:auto;width:160px}.header--large{padding:16px}.header--large a{font-size:20px}.footer{padding:10px;background:#f5f5f5}.footer__copyright{display:block;font-variant:small-caps}.footer__copyright a,a.header__logo{border-bottom:0}.summary{padding:16px;color:#fff}.summary__date:hover{color:#ccc}.summary__date:hover:after{content:' ⟳ ';color:#fff}.components{border:2px solid #ddd;border-bottom:0}.component{color:#000;padding:16px;border-bottom:2px solid #ddd}.tooltip{cursor:pointer;position:relative}.tooltip__text{display:none}.tooltip:hover .tooltip__text,.tooltip:active .tooltip__text{display:block;position:absolute;top:0;left:24px;background:#181818;color:#fff;z-index:50;padding:8px;border:2px solid #242424;font-size:14px;color:#ccc;width:320px;height:auto}@media(max-width:640px){.tooltip:hover .tooltip__text,.tooltip:active .tooltip__text{width:50vw}}.tabs{border-bottom:1px solid #ccc}.tabs--inner{padding:0 16px;margin:0 auto}a.tab{display:inline-table}.tab--current{border:1px solid #ccc;border-bottom-color:#fff;padding:12px 18px;position:relative;top:1px}.tab--other{border:0;padding:12px 18px;position:relative;top:1px;color:#757575}.tab--other:hover{color:#000}.issue{display:block;padding:14px 24px}.issue:hover,.category__head:hover{background:#f5f5f5}.issue:active,.category__head:active{background:#eee}.issue h3{line-height:1.25}.category__head{margin-top:20px}.archive__head{padding:20px;background:#f5f5f5}.status-ok .summary{background:green}.status-disrupted .summary,.change-header-color.status-disrupted .header{background:#c40}.status-down .summary,.change-header-color.status-down .header{background:#e60000}.status-notice .summary,.change-header-color.status-notice .header{background:#24478f}.announcement-box .padding{padding:16px}.status-disrupted .announcement-box{border:2px solid #c40}.status-down .announcement-box{border:2px solid #e60000}.status-notice .announcement-box{border:2px solid #24478f}.status-disrupted .announcement-box,.status-down .announcement-box,.status-notice .announcement-box{border-top:0}.category--open .category-status{display:none}.component-status,.category-status{float:right}.component[data-status=ok] .component-status,.category__head[data-status=ok] .category-status{color:green}.component[data-status=disrupted] .component-status,.category__head[data-status=disrupted] .category-status{color:#c40}.component[data-status=notice] .component-status,.category__head[data-status=notice] .category-status{color:#24478f}.component[data-status=down] .component-status,.category__head[data-status=down] .category-status{color:#e60000}@media(min-width:640px){.float-right{float:right;display:inline}}@media(prefers-color-scheme:dark){html,body{background:#181a1b;color:#ccc9c1}h1,h2,h3,h4,a,.bold{color:#fafafa}hr{border-bottom-color:#3d3d3d}.footer{background:#1b1d1e}.components{border:2px solid #ddd;border-bottom:0;border-color:#3a3a3a}.component{border-bottom:2px solid #ddd;color:#e8e6e3;border-bottom-color:#3a3a3a}.tabs{border-bottom-color:#3d3d3d}.tab--current{border-color:#3d3d3d;border-bottom-color:#181a1b}.tab--other{color:#757575}.tab--other:hover{color:#fff}.date{color:#c3bfb6}.tag,.archive__head{background-color:#1d1f20}.tag:hover{background:#222}.issue:hover,.category__head:hover{background-color:#212121}.hinted,.faded{color:#c1bcb3}.error{color:#ff4242}.warning{color:#ffde7f}.ok{color:#7fff7f}.component[data-status=ok] .component-status,.category__head[data-status=ok] .category-status{color:#7fff7f}.component[data-status=disrupted] .component-status,.category__head[data-status=disrupted] .category-status{color:#ffde7f}.component[data-status=notice] .component-status,.category__head[data-status=notice] .category-status{color:#83a4e8}.component[data-status=down] .component-status,.category__head[data-status=down] .category-status{color:#ff8181}}</style><style>.pre-header-links{background-color:#0a0c0f;text-align:right;padding-right:10px}.pre-header-links a{border-bottom:none;color:#fff}</style><meta property="og:url" content="https://info.linuxserver.io/issues/2023-05-29-mariadb/"><meta property="og:type" content="website"><meta property="og:title" content="Known Issue: MariaDB Check and Repair | Info :: LinuxServer.io"><meta property="og:description" content="There is a known issue with MariaDB when updating the container image to a new version. If a database upgrade is required and user databases are not in a healthy state, then the MariaDB service may fail to start.
MariaDB version updates (ex: 10.6.x to 10.11.x) can happen when updating the container image. Upgrading user databases is done manually by running a command.
Recovery Procedure If you have recently updated your container image and your container logs show repeating entries of:"><meta property="og:image" content="https://info.linuxserver.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="info.linuxserver.io"><meta property="twitter:url" content="https://info.linuxserver.io/issues/2023-05-29-mariadb/"><meta name=twitter:title content="Known Issue: MariaDB Check and Repair | Info :: LinuxServer.io"><meta name=twitter:description content="There is a known issue with MariaDB when updating the container image to a new version. If a database upgrade is required and user databases are not in a healthy state, then the MariaDB service may fail to start.
MariaDB version updates (ex: 10.6.x to 10.11.x) can happen when updating the container image. Upgrading user databases is done manually by running a command.
Recovery Procedure If you have recently updated your container image and your container logs show repeating entries of:"><meta name=twitter:image content="https://info.linuxserver.io/logo.png"></head><body class="issues single"><div class=contain><a href=https://info.linuxserver.io>← Go back to <em>Info :: LinuxServer.io</em></a></div><div class=contain><div class=article><h1 class=clean>Known Issue: MariaDB Check and Repair</h1><small class=date>May 29, 2023 at 12:00 PM</small><p><small><a href=/affected/known-issues/ class="tag no-underline">Known Issues</a>
<a href=/affected/mariadb/ class="tag no-underline">mariadb</a></small></p><div class="warning tooltip"><strong>Resolved after
2409h
0m</strong>
<span class=tooltip__text>September 6, 2023 at 9:00 PM</span></div><hr><div class=markdown><p>There is a known issue with MariaDB when updating the container image to a new version. If a database upgrade is required and user databases are not in a healthy state, then the MariaDB service may fail to start.</p><p>MariaDB version updates (ex: <code>10.6.x</code> to <code>10.11.x</code>) can happen when updating the container image. Upgrading user databases is done manually by running a command.</p><h3 id=recovery-procedure>Recovery Procedure</h3><p>If you have recently updated your container image and your container logs show repeating entries of:</p><pre tabindex=0><code class=language-log data-lang=log>Caught SIGTERM signal!
</code></pre><ul><li>Roll back the container image to a previous tag (ex: <code>lscr.io/linuxserver/mariadb:10.6.13</code> assuming this was the version you were running when things were last working)</li><li>Run the check, repair, analyze, and optimize commands, watch for any issues</li><li>Update the container image to the new tag (ex: <code>lscr.io/linuxserver/mariadb:10.11.3</code> or <code>lscr.io/linuxserver/mariadb:latest</code>)</li><li>Run the upgrade command</li></ul><p>This should get MariaDB running again with your user databases in a healthy state.</p><h3 id=check-and-repair>Check and Repair</h3><p>If user databases are not in a healthy state (sometimes caused by a failed upgrade), it may be remedied by running:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mariadb-check -u root -p&lt;PASSWORD&gt; -c -A <span style=color:#75715e># check all databases for errors</span>
</span></span><span style=display:flex><span>mariadb-check -u root -p&lt;PASSWORD&gt; -r -A <span style=color:#75715e># repair all databases</span>
</span></span><span style=display:flex><span>mariadb-check -u root -p&lt;PASSWORD&gt; -a -A <span style=color:#75715e># analyze all databases</span>
</span></span><span style=display:flex><span>mariadb-check -u root -p&lt;PASSWORD&gt; -o -A <span style=color:#75715e># optimize all databases</span>
</span></span></code></pre></div><p>After running the above commands, you may need to run the upgrade command again.</p><h3 id=upgrading>Upgrading</h3><p>When this container initializes, if <code>MYSQL_ROOT_PASSWORD</code> is set an upgrade check will run. If an upgrade is required the log will indicate the need stop any services that are accessing databases in this container, and then run the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mariadb-upgrade -u root -p&lt;PASSWORD&gt;
</span></span></code></pre></div><h3 id=closing-notes>Closing Notes</h3><p>If you are running MariaDB databases in production, we always recommend pinning the container image to a specific version tag, such as <code>lscr.io/linuxserver/mariadb:10.6.13-r0-ls97</code>, and planning any upgrades so that you can test and monitor them.</p></div></div><div class=padding></div></div><div class="contain center"><p>Last updated:
September 5, 2023 at 7:11 PM</p></div><script type=text/javascript>console.log('cState v5.6.1 - https://github.com/cstate/cstate'),document.getElementsByTagName('html')[0].className='js',document.body.className==='change-header-color'&&(document.body.className==='status-down'?document.querySelector('meta[name=theme-color]').setAttribute('content',themeDownColor):document.body.className==='status-disrupted'?document.querySelector('meta[name=theme-color]').setAttribute('content',themeDisruptedColor):document.querySelector('meta[name=theme-color]').setAttribute('content',themeNoticeColor)),window.location.hash.match('access_token')&&(document.location.pathname='/admin'),window.location.hash.match('invite_token')&&(document.location.pathname='/admin'),window.location.hash.match('confirmation_token')&&(document.location.pathname='/admin'),window.location.hash.match('email_change_token')&&(document.location.pathname='/admin'),window.location.hash.match('recovery_token')&&(document.location.pathname='/admin');function toggleCategoryHead(e){e.parentNode.className=='category category--open category--titled'?e.parentNode.className='category category--closed category--titled':e.parentNode.className='category category--open category--titled'}function timeSince(n){var t=Math.floor((new Date-n)/1e3),e=Math.floor(t/31536e3);return e>1?e+' years':(e=Math.floor(t/2592e3),e>1?e+' months':(e=Math.floor(t/86400),e>1?e+'d':(e=Math.floor(t/3600),e>1?e+'h':(e=Math.floor(t/60),e>1?e+' min':Math.floor(t)<0?Math.floor(t):Math.floor(t)+'s'))))}function updateRelativeTimes(){for(var e,t,n,o=document.querySelectorAll('.relative-time'),s=0;s<o.length;s++)e=o[s],t=Date.parse(e.dataset.date),n=e.getAttribute('data-time-prefix')||'',t?timeSince(t)<0?n=e.innerText:n+=timeSince(t)+' ago':(t=e.innerText,e.setAttribute('title',t||new Date),n+='just now'),n+=e.getAttribute('data-time-suffix')||'',e.innerHTML=n.trim()}updateRelativeTimes(),setInterval(updateRelativeTimes,5e3)</script><div class=footer><div class=contain><p><strong class=bold>&copy; Info :: LinuxServer.io, 2024</strong>
&nbsp; • &nbsp; <a href=#>Back to top</a></p><p>LinuxServer.io Status page</p><small class="footer__copyright faded">Powered by <a href=https://github.com/cstate/cstate><b>cState</b></a></small><hr><p class=hinted><small>⚡
Subscribe via RSS —
<a href=https://info.linuxserver.io/index.xml class=no-underline>to all updates</a></small></p></div></div></body></html>