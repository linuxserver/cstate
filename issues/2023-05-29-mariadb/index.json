{"is":"issue","title":"Known Issue: MariaDB Check and Repair","body":"\u003cp\u003eThere is a known issue with MariaDB when updating the container image to a new version. If a database upgrade is required and user databases are not in a healthy state, then the MariaDB service may fail to start.\u003c/p\u003e\n\u003cp\u003eMariaDB version updates (ex: \u003ccode\u003e10.6.x\u003c/code\u003e to \u003ccode\u003e10.11.x\u003c/code\u003e) can happen when updating the container image. Upgrading user databases is done manually by running a command.\u003c/p\u003e\n\u003ch3 id=\"recovery-procedure\"\u003eRecovery Procedure\u003c/h3\u003e\n\u003cp\u003eIf you have recently updated your container image and your container logs show repeating entries of:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-log\" data-lang=\"log\"\u003eCaught SIGTERM signal!\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eRoll back the container image to a previous tag (ex: \u003ccode\u003elscr.io/linuxserver/mariadb:10.6.13\u003c/code\u003e assuming this was the version you were running when things were last working)\u003c/li\u003e\n\u003cli\u003eRun the check, repair, analyze, and optimize commands, watch for any issues\u003c/li\u003e\n\u003cli\u003eUpdate the container image to the new tag (ex: \u003ccode\u003elscr.io/linuxserver/mariadb:10.11.3\u003c/code\u003e or \u003ccode\u003elscr.io/linuxserver/mariadb:latest\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eRun the upgrade command\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis should get MariaDB running again with your user databases in a healthy state.\u003c/p\u003e\n\u003ch3 id=\"check-and-repair\"\u003eCheck and Repair\u003c/h3\u003e\n\u003cp\u003eIf user databases are not in a healthy state (sometimes caused by a failed upgrade), it may be remedied by running:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emariadb-check -u root -p\u0026lt;PASSWORD\u0026gt; -c -A \u003cspan style=\"color:#75715e\"\u003e# check all databases for errors\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emariadb-check -u root -p\u0026lt;PASSWORD\u0026gt; -r -A \u003cspan style=\"color:#75715e\"\u003e# repair all databases\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emariadb-check -u root -p\u0026lt;PASSWORD\u0026gt; -a -A \u003cspan style=\"color:#75715e\"\u003e# analyze all databases\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emariadb-check -u root -p\u0026lt;PASSWORD\u0026gt; -o -A \u003cspan style=\"color:#75715e\"\u003e# optimize all databases\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAfter running the above commands, you may need to run the upgrade command again.\u003c/p\u003e\n\u003ch3 id=\"upgrading\"\u003eUpgrading\u003c/h3\u003e\n\u003cp\u003eWhen this container initializes, if \u003ccode\u003eMYSQL_ROOT_PASSWORD\u003c/code\u003e is set an upgrade check will run. If an upgrade is required the log will indicate the need stop any services that are accessing databases in this container, and then run the command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emariadb-upgrade -u root -p\u0026lt;PASSWORD\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"closing-notes\"\u003eClosing Notes\u003c/h3\u003e\n\u003cp\u003eIf you are running MariaDB databases in production, we always recommend pinning the container image to a specific version tag, such as \u003ccode\u003elscr.io/linuxserver/mariadb:10.6.13-r0-ls97\u003c/code\u003e, and planning any upgrades so that you can test and monitor them.\u003c/p\u003e\n","createdAt":"2023-05-29 12:00:00 +0000 UTC","lastMod":"2023-09-05 19:11:23 +0100 +0100","permalink":"https://info.linuxserver.io/issues/2023-05-29-mariadb/","severity":"notice","resolved":true,"informational":false,"resolvedAt":"2023-09-06 21:00:00Z","affected":["Known Issues","mariadb"],"filename":"2023-05-29-mariadb.md"}